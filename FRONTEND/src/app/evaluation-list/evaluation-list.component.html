<app-navbar></app-navbar>
<div class="section-py landing-hero position-relative" >
<div style="margin-top: 100px;">
  <!-- Your tab navigation and formations list here -->
</div>
<div class="quiz-wrapper container mt-5">
  <div class="header-section">
    <h2><i class="fas fa-list me-2"></i> Liste des Quiz</h2>
  </div>

  <div class="button-section">
    <button (click)="navigateTopredict()" class="btn-gradient">Predict Course Completion</button>
    <button (click)="navigateToQuizapi()" class="btn-pink">QUIZApi</button>
  </div>

  <div class="container mt-4">
    <div class="card quiz-card shadow">
      <div class="card-header custom-header">
        <h3 class="mb-0">
          <i class="fas fa-tasks me-2"></i>Assign Questions to Quiz
        </h3>
      </div>

      <div class="card-body">
        <div class="list-group">
          <div *ngFor="let eval of evaluations" class="list-group-item quiz-item">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <h5>{{ eval.titre }}</h5>
                <small class="text-muted">{{ eval.description }}</small>
              </div>
              <span class="badge" [ngClass]="{
                'bg-warning text-dark': !questionsMap[eval.idEvaluation]?.length,
                'bg-success': questionsMap[eval.idEvaluation]?.length
              }">
                {{ getEvaluationStatus(eval.idEvaluation) }}
              </span>
            </div>

            <div *ngIf="expandedEvaluation === eval.idEvaluation" class="mt-3">
              <div *ngIf="loadingStates[eval.idEvaluation]" class="text-center py-2">
                <div class="spinner-border spinner-border-sm text-primary"></div>
                <span>Loading questions...</span>
              </div>

              <div *ngIf="!loadingStates[eval.idEvaluation]">
                <div *ngIf="!questionsMap[eval.idEvaluation]?.length" class="alert alert-warning">
                  No questions assigned yet
                </div>

                <div *ngIf="questionsMap[eval.idEvaluation]?.length" class="mt-2">
                  <h6>Assigned Questions:</h6>
                  <ul class="list-group">
                    <li *ngFor="let question of questionsMap[eval.idEvaluation]" class="list-group-item">
                      {{ question.texte || question.contenu || 'No question text' }}
                    </li>
                  </ul>
                </div>
              </div>
            </div>

            <div class="d-flex gap-2 mt-2 flex-wrap">
              <button class="btn btn-outline-primary btn-sm"
                      (click)="toggleEvaluationDetails(eval.idEvaluation)">
                {{ expandedEvaluation === eval.idEvaluation ? 'Hide' : 'Show' }} Details
              </button>

              <button class="btn btn-success btn-sm"
                      (click)="startEvaluation(eval.idEvaluation)"
                      [disabled]="!questionsMap[eval.idEvaluation]?.length">
                Start Quiz
              </button>

              <button class="btn btn-pink btn-sm"
                      (click)="assignQuestions(eval)"
                      title="Assign questions to this quiz">
                <i class="fas fa-tasks me-1"></i> Assign Questions
              </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

